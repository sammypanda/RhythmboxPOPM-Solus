#!/bin/bash
#vars
python=`command -v pip3`

#generic
msg_installing() {
	echo -e "ğŸš§ installing $1\n"
}

msg_installed() {
	echo -e "âœ… $1 already installed\n"
}

#dependencies
if ! command -v pip3 &> /dev/null; then
        msg_installing "python3 & pip3"
        sudo eopkg install python3
	echo -e
else
	msg_installed "python3 & pip"
	echo -e
fi

if ! command -v exiftool &> /dev/null; then
        msg_installing "exiftool"
        sudo eopkg install perl-image-exiftool
	echo -e
else
	msg_installed "exiftool"
fi

if ! command -v eyeD3 &> /dev/null; then
	msg_installing "eyeD3"
	pip3 install eyeD3
	echo -e
else
	msg_installed "eyeD3"
fi

#move the startups
echo -e "ğŸ—‘ï¸  sending 'rbtopopm' to /usr/bin\n"
sudo cp rbtopopm /usr/bin/
sudo chmod +x /usr/bin/rbtopopm

echo -e "ğŸ—‘ï¸  sending 'popmtorb' to /usr/bin\n"
sudo cp popmtorb /usr/bin
sudo chmod +x /usr/bin/popmtorb

#compile the jars
echo -e "â˜• compiling and sending the jars to /usr/bin\n"
javac RBToPOPM.java POPMToRB.java ID3Reader.java Rating.java &> /dev/null
jar cvf RhythmBoxToPOPM.jar RBToPOPM.class &> /dev/null
jar cvf POPMToRhythmBox.jar POPMToRB.class ID3Reader.class Rating.class &> /dev/null
#move the jars
sudo cp RhythmBoxToPOPM.jar /usr/bin/
sudo cp POPMToRhythmBox.jar /usr/bin/

#final checks and notifs! >o<
if ! command -v java &> /dev/null; then
	was_crit_error=1
	echo -e "â›” java not found in path\n" 
fi

if ! command -v javac &> /dev/null; then
	was_crit_error=1
	echo -e "â›” javac not found in path\n"
fi

if [ $was_crit_error ]; then
	echo "ğŸ’” could not build"
	exit
elif [ $was_error ]; then
	echo "âš ï¸  there was a problem, building anyway"
else
	echo "ğŸ’– build finished!"
fi
